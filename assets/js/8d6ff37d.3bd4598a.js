"use strict";(self.webpackChunkuniversalreference_io=self.webpackChunkuniversalreference_io||[]).push([[3447],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var l=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,l,i=function(e,t){if(null==e)return{};var n,l,i={},o=Object.keys(e);for(l=0;l<o.length;l++)n=o[l],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(l=0;l<o.length;l++)n=o[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=l.createContext({}),s=function(e){var t=l.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=s(e.components);return l.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},d=l.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),d=s(n),h=i,m=d["".concat(c,".").concat(h)]||d[h]||p[h]||o;return n?l.createElement(m,r(r({ref:t},u),{},{components:n})):l.createElement(m,r({ref:t},u))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=d;var a={};for(var c in t)hasOwnProperty.call(t,c)&&(a[c]=t[c]);a.originalType=e,a.mdxType="string"==typeof e?e:i,r[1]=a;for(var s=2;s<o;s++)r[s]=n[s];return l.createElement.apply(null,r)}return l.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4350:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>s});var l=n(7462),i=(n(7294),n(3905));const o={},r="Collection Workflows",a={unversionedId:"Client/design/collections",id:"Client/design/collections",title:"Collection Workflows",description:"- Collection Workflows",source:"@site/docs/Client/design/collections.md",sourceDirName:"Client/design",slug:"/Client/design/collections",permalink:"/docs/Client/design/collections",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Client/design/collections.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Design",permalink:"/docs/category/design"},next:{title:"Model",permalink:"/docs/Client/design/model"}},c={},s=[{value:"Collection Publishing",id:"collection-publishing",level:2},{value:"Collection Pulling",id:"collection-pulling",level:2},{value:"Collection Manager",id:"collection-manager",level:2}],u={toc:s};function p(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,l.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"collection-workflows"},"Collection Workflows"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#collection-workflows"},"Collection Workflows"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#collection-publishing"},"Collection Publishing")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#collection-pulling"},"Collection Pulling"))))),(0,i.kt)("h2",{id:"collection-publishing"},"Collection Publishing"),(0,i.kt)("p",null,"The workflow for collection publishing is very similar to the workflow used to build container images with most tooling options.\nIf the schema is published before the collection and associated to the collection, the specified attributes in the dataset configuration\nwill be validated against the schema during collection building.\nThis is demonstrated below by the diagram."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-mermaid"},"graph LR;\nA[Build]--\x3eB{Collection or Schema?};\nB -- Schema --\x3e C[Build Schema]\nB -- Collection --\x3e D[Build Collection]\nC --\x3e E[Push Schema]\nE --\x3e D\nD --\x3e F[Push Collection]\n")),(0,i.kt)("p",null,"This would be the workflow if the ultimate goal was to publish a collection with or without a schema. Schema can be published\nwithout a subsequent collection publish for later use as well."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-mermaid"},"graph LR;\nA[Build]--\x3eB{Collection or Schema?};\nB -- Schema --\x3e C[Build Schema]\nB -- Collection --\x3e D[Build Collection]\nC --\x3e E[Push]\nD --\x3e E\n")),(0,i.kt)("h2",{id:"collection-pulling"},"Collection Pulling"),(0,i.kt)("p",null,"Collections can be pulled as an entire OCI Artifact or filtered by an Attribute Query. The filtered OCI artifact is stored\nin the build cache with the original manifest intact (sparse manifest) and the non-matching blobs (files) are not pulled into the cache.\nAll matching files are written to the cache and written to a user specified location."),(0,i.kt)("p",null,"The use of sparse manifest can pose a problem if re-tagging collections becomes part of the command line functionality in the future.\nSome registries will reject manifests without all the blobs present. In this case, it may be of interest to reconstruct the manifest before pushing\nand allow a flag to preserve the manifest, if desired."),(0,i.kt)("h2",{id:"collection-manager"},"Collection Manager"),(0,i.kt)("p",null,"Collection publishing and pulling can be accomplished over gRPC with the ",(0,i.kt)("inlineCode",{parentName:"p"},"serve")," command.\nThe client acts as a gRPC server that will retrieve and publish collections upon client request.\nA top-level type called ",(0,i.kt)("inlineCode",{parentName:"p"},"Manager")," is used to provide this functionality to the CLI and gRPC server. There is a default implementation located\nin the ",(0,i.kt)("inlineCode",{parentName:"p"},"manager")," package that is currently used."),(0,i.kt)("p",null,"The gRPC server is reading and writing in locations relative to its instantiated location. Due to this, a unix domain socket is used for client/server communication. gRPC client\nmust provide absolute pathing for expected results."))}p.isMDXComponent=!0}}]);